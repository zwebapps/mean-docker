<div class="academy-row" [style.background-color]="academy?.color">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-12 col-lg-2" *ngIf="teamDeails">
        <div class="acedmy-plus"><img [src]="getImg(teamDeails?.academy_id?.logo)" class="img-fluid" /><br /></div>
      </div>
      <div class="col-12 col-lg-5 academy-name" *ngIf="teamDeails">
        <p>{{ teamDeails.teamName }}</p>
        <p class="academy-team">{{ teamDeails?.league?.leagueName }}</p>
      </div>
      <div class="col-12 col-lg-5 academy-name text-end" *ngIf="coachCompetition && coachCompetition?.competitionName">
        <p *ngIf="academy">{{ coachCompetition?.competitionName }}</p>
        <p class="academy-team"></p>
      </div>
    </div>
  </div>
</div>
<ng-template #content let-modal size="950px">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Contact YFL</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <app-contact-admin [adminRecipientEmail]="adminRecipientEmail"></app-contact-admin>
  </div>
  <div class="modal-footer">
    <!-- <div class="justify-content-center">
      <button type="button" class="btn btn-outline-dark">Update Competition</button>
    </div> -->
  </div>
</ng-template>
<!-- <div class="row">
  <form>
    <div class="row justify-content-start" *ngIf="leagues">
      <ng-container *ngFor="let league of leagues; let i = index">
        <div class="col-lg-3 col-sm-6 col-xs-6">
          <div class="league-lable">
            <div class="list-group-item">
              {{ league.leagueName }}
              <input
                class="form-check-input me-1"
                type="checkbox"
                value="false"
                (change)="onCheckBox(league)"
                [checked]="league.selected"
                [(ngModel)]="league.selected"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </form>
</div> -->

<!-- <div class="row">
  <br />
  <hr />
</div> -->
<!-- <div class="row text-center mb-4">
  <div class="d-flex justify-content-end">
    <div class="col-12 col-lg-6 pe-5">
      <h2 class="me-5">
        {{ team.teamName }}
      </h2>
    </div>
    <div class="col-12 col-lg-6 text-end me-5">
      <h2 *ngIf="selectedLeague">{{ selectedLeague.leagueName ? selectedLeague.leagueName : "No League Selected" }}</h2>
    </div>
  </div>
</div> -->
<!-- <div class="row page-title-bar">
  <div class="col-lg-12 heading-row">
    <h3 class="page-title">Coaches Details</h3>
  </div>
  <hr />
</div> -->
<!-- <div class="row">
  <div class="col-lg-3 col-sm-12 col-xs-12 col-md-3">
    <div class="form-group">
      <label for="name" class="control-label">Name</label>
      <input
        type="email"
        value=""
        class="form-control"
        id="name"
        [value]="coach.firatname ? coach.firatname + ' ' + coach.lastname : coach.username"
        placeholder="Name"
        disabled
      />
    </div>
  </div>
  <div class="col-lg-3 col-sm-12 col-xs-12 col-md-3">
    <div class="form-group">
      <label for="name" class="control-label">Email</label>
      <input type="email" value="" class="form-control" id="name" [value]="coach?.email" placeholder="Email" disabled />
    </div>
  </div>
  <div class="col-lg-3 col-sm-12 col-xs-12 col-md-3">
    <div class="form-group">
      <label for="name" class="control-label">Mobile</label>
      <input
        type="email"
        value=""
        class="form-control"
        id="name"
        [value]="coach.contact ? coach.contact : 'No Mobile'"
        placeholder="Mobile"
        disabled
      />
    </div>
  </div>
</div> -->
<!-- <div class="row squads pt-3">
  <div class="col-12 col-md-6 col-lg-8">
    <div class="row pt-3">
      <div class="squads-lable col-12 col-lg-4 mb-3" (click)="export()">
        <span class="squads-text">Download CSV Template</span>
      </div>
      <div class="squads-lable col-12 col-lg-4 mb-3">
        <div class="input-container">
          Uploads Players <small>(.csv / .xls)</small>
          <input
            #csvUpload
            type="file"
            name="file"
            (change)="onChange($event)"
            accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
          />
        </div>
      </div>
      <div class="squads-lable col-12 col-lg-4 mb-3">
        <div class="input-container">
          BulK EID Uploads
          <input type="file" name="file" (change)="getImages($event)" accept="image/*" multiple />
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-4 mb-3">
        <div class="btn squads-lable col-12" (click)="togglePlayerForm()">
          <span class="squads-text">Add Player</span>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6 col-lg-4 justify-content-around">
    <div class="btn squads-lable col-12" (click)="onContactUs()">
      <span class="squads-text">Contact Us</span>
    </div>
    <div class="col-12">
      <p>To move a player or player doesn't have a EID</p>
    </div>
  </div>
</div> -->
<div class="container">
  <div class="row" *ngIf="displayAddPlayer">
    <div class="form-wrapper">
      <form [formGroup]="playerForm" class="justify-content-around" method="post" enctype="multipart/form-data" (ngSubmit)="onFormSubmit()">
        <div class="row justify-content-between">
          <div class="form-group col-12 col-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">
              <i class="bi bi-person-exclamation"></i> &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Gender
            </label>
            <div class="input-group">
              <div class="input-group-prepend">
                <button class="btn btn-outline-dark" type="button">
                  <input
                    class="btn btn-success"
                    type="checkbox"
                    value=""
                    formControlName="limitedAbility"
                    [checked]="false"
                    (change)="associatedLeaguesForSelectedTeam($event.target.value)"
                  />
                </button>
              </div>

              <select
                class="form-select form-control"
                name="gender"
                aria-label="Default select"
                formControlName="gender"
                (change)="associatedLeaguesForSelectedTeam($event.target.value)"
              >
                <option value="">Select Gender</option>
                <option value="Male" selected>Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">First Name</label>
            <input
              type="text"
              [value]="784 - 1234 - 1234567 - 1"
              class="form-control"
              placeholder="First Name"
              formControlName="firstName"
              class="form-control"
              [ngClass]="{ 'is-invalid': submitted && f['firstName'].errors }"
            />
            <div *ngIf="submitted && f['firstName'].errors" class="invalid-feedback">
              <div *ngIf="f['firstName'].errors['required']">
                <small>First Name is required</small>
              </div>
            </div>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">Surname</label>
            <input
              type="text"
              value=""
              class="form-control"
              id="name"
              placeholder="Surname"
              formControlName="surName"
              class="form-control"
              [ngClass]="{ 'is-invalid': submitted && f['surName'].errors }"
            />
            <div *ngIf="submitted && f['surName'].errors" class="invalid-feedback">
              <div *ngIf="f['surName'].errors['required']">
                <small>Surname is required</small>
              </div>
            </div>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">Date of birth</label>
            <input
              type="date"
              value=""
              class="form-control"
              id="name"
              placeholder="DOB"
              formControlName="dob"
              class="form-control"
              (blur)="getMaxAgeLeagues($event.target.value)"
              [ngClass]="{ 'is-invalid': submitted && f['dob'].errors }"
            />
            <div *ngIf="submitted && f['dob'].errors" class="invalid-feedback">
              <div *ngIf="f['dob'].errors['required']">
                <small>Date of birth is required</small>
              </div>
            </div>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="squadNo" class="control-label">Squad No</label>
            <input
              type="number"
              value=""
              class="form-control"
              id="squadNo"
              placeholder="squadNo"
              formControlName="squadNo"
              class="form-control"
              [ngClass]="{ 'is-invalid': submitted && f['squadNo'].errors }"
            />
            <div *ngIf="submitted && f['squadNo'].errors" class="invalid-feedback">
              <div *ngIf="f['squadNo'].errors['required']">
                <small>Squad no is required</small>
              </div>
            </div>
          </div>
          <!-- <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">League</label>
            <input
              type="text"
              [value]="selectedLeague?.leagueName"
              class="form-control"
              id="name"
              placeholder="League"
              formControlName="league"
              [ngClass]="{ 'is-invalid': submitted && f['league'].errors }"
            />
            <div *ngIf="submitted && f['league'].errors" class="invalid-feedback">
              <div *ngIf="f['league'].errors['required']">
                <small>League is required</small>
              </div>
            </div>
          </div> -->
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="league" class="control-label">League</label>
            <input
              type="text"
              [class]="'form-control'"
              [placeholder]="League"
              formControlName="league"
              [value]="teamDeails?.league?.leagueName"
            />
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="league" class="control-label">Team</label>
            <input type="text" [class]="'form-control'" [placeholder]="Team" formControlName="team" [value]="teamDeails?.teamName" />
          </div>
          <!-- <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="league" class="control-label">League</label>
            <select
              class="form-select"
              name="league"
              aria-label="Default select"
              (change)="onCheckBox($event.target.value)"
              formControlName="league"
            >
              <option value="0">Select League</option>
              <ng-container *ngIf="leagues">
                <ng-container *ngFor="let league of leagues; let i = index">
                  <option [value]="league._id" [checked]="league.selected">{{ league.leagueName }} {{ league.selected }}</option>
                </ng-container>
              </ng-container>
            </select>
          </div> -->
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="playerEidNo" class="control-label">EID No</label>
            <input
              type="text"
              [(ngModel)]="eidNo"
              [value]="eidNo"
              name="playerEidNo"
              id="playerEidNo"
              class="form-control"
              placeholder="784-1234-1234567-1"
              formControlName="playerEidNo"
              (keypress)="appendHiphen($event)"
              [ngClass]="{ 'is-invalid': submitted && f['playerEidNo'].errors }"
              size="18"
            />
            <!-- (blur)="playerbyEmirateId($event)" -->
            <div *ngIf="submitted && f['playerEidNo'].errors" class="invalid-feedback">
              <div *ngIf="f['playerEidNo'].errors['required']">
                <small>Player EID no and pattern should is required</small>
              </div>
            </div>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="eidFront" class="control-label">EID Front</label>
            <input
              type="file"
              value=""
              class="form-control"
              id="eidFront"
              name="eidFront"
              placeholder="EID Front"
              (change)="uploadEmiratesID($event)"
              formControlName="eidFront"
              class="form-control"
              accept="image/*"
              [ngClass]="{ 'is-invalid': submitted && f['eidFront'].errors }"
            />
            <div *ngIf="submitted && f['eidFront'].errors" class="invalid-feedback">
              <div *ngIf="f['eidFront'].errors['required']">
                <small>EID Front is required</small>
              </div>
            </div>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="eidBack" class="control-label">EID Back</label>
            <input
              type="file"
              value=""
              class="form-control"
              id="eidBack"
              name="eidBack"
              placeholder="EID Back"
              (change)="uploadEmiratesID($event)"
              formControlName="eidBack"
              class="form-control"
              accept="image/*"
              [ngClass]="{ 'is-invalid': submitted && f['eidBack'].errors }"
            />
            <div *ngIf="submitted && f['eidBack'].errors" class="invalid-feedback">
              <div *ngIf="f['eidBack'].errors['required']">
                <small>EID Back is required</small>
              </div>
            </div>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="playingup" class="control-label">Playing Up League</label>
            <ng-multiselect-dropdown
              [class]=""
              [placeholder]="'Playing up league'"
              [settings]="dropdownSettings"
              [data]="dropleagues"
              (onSelect)="onItemSelect($event)"
              (onSelectAll)="onSelectAll($event)"
              formControlName="playingUp"
            >
            </ng-multiselect-dropdown>
          </div>
          <div class="form-group col-sm-12 col-xs-12 col-md-3 col-lg-3 m-2">
            <label for="playingup" class="control-label">Playing Up Team</label>
            <ng-multiselect-dropdown
              [class]=""
              [placeholder]="'Playing up team'"
              [settings]="dropdownTeamSettings"
              [data]="dropteams"
              (onSelect)="onTeamSelect($event)"
              (onSelectAll)="onSelectAll($event)"
              formControlName="playingUpTeam"
            >
            </ng-multiselect-dropdown>
          </div>
          <div class="row d-flex justify-content-center">
            <div class="form-group col-xs-12 col-md-3 col-lg-3 mt-2 align-items-end">
              <div class="ms-3 w-100">
                <button type="submit" class="btn btn-gradient col-12 text-white" [disabled]="playerExists">Add Player</button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="row" *ngIf="displayEditPlayer">
    <div class="form-wrapper">
      <form
        [formGroup]="editPlayerForm"
        class="justify-content-around"
        method="post"
        enctype="multipart/form-data"
        (ngSubmit)="onUpdatePlayer()"
      >
        <div class="row justify-content-center">
          <div class="form-group col-12 col-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">
              <i class="bi bi-person-exclamation"></i> &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Gender
            </label>
            <div class="input-group">
              <div class="input-group-prepend">
                <button class="btn btn-outline-dark" type="button">
                  <input
                    class="btn btn-success"
                    type="checkbox"
                    value=""
                    formControlName="limitedAbility"
                    [checked]="false"
                    (change)="leagueForUpPlay($event.target.value)"
                  />
                </button>
              </div>

              <select
                class="form-select form-control"
                name="gender"
                aria-label="Default select"
                (change)="leagueForUpPlay($event.target.value)"
                formControlName="gender"
              >
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
          </div>
          <div class="form-group col-12 col-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">First Name</label>
            <input
              type="text"
              class="form-control"
              id="name"
              placeholder="First Name"
              formControlName="firstName"
              class="form-control"
              disabled
            />
          </div>
          <div class="form-group col-12 col-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">Last Name</label>
            <input
              type="text"
              class="form-control"
              id="name"
              placeholder="Last Name"
              formControlName="surName"
              class="form-control"
              disabled
            />
          </div>
          <div class="form-group col-12 col-12 col-md-3 col-lg-3 m-2">
            <label for="name" class="control-label">Date of birth</label>
            <input
              type="text"
              class="form-control"
              id="name"
              placeholder="DOB"
              formControlName="dob"
              class="form-control"
              (blur)="getMaxAgeLeagues($event.target.value)"
              disabled
            />
          </div>

          <div class="form-group col-12 col-12 col-md-3 col-lg-3 m-2">
            <label for="playingup" class="control-label">Playing Up League</label>
            <ng-multiselect-dropdown
              [class]=""
              [placeholder]="'Playing up league'"
              [settings]="dropdownSettings"
              [data]="dropleagues"
              [(ngModel)]="selectedPlayingLeagues"
              (onSelect)="onItemSelect($event)"
              (onSelectAll)="onSelectAll($event)"
              formControlName="playingUp"
            >
            </ng-multiselect-dropdown>
          </div>
          <div class="form-group col-12 col-12 col-md-3 col-lg-3 m-2">
            <label for="playingup" class="control-label">Playing Up Team</label>
            <ng-multiselect-dropdown
              [class]=""
              [placeholder]="'Playing up team'"
              [settings]="dropdownTeamSettings"
              [data]="dropteams"
              [(ngModel)]="selectedPlayingUpTeams"
              (onSelect)="onTeamSelect($event)"
              (onSelectAll)="onSelectAll($event)"
              formControlName="playingUpTeam"
            >
            </ng-multiselect-dropdown>
          </div>
          <div class="row d-flex justify-content-center">
            <div class="form-group col-xs-12 col-md-3 col-lg-3 mt-2 align-items-end">
              <button type="submit" class="btn btn-gradient col-12">Update Player</button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="row page-filter-bar">
    <div class="col-lg-6">
      <div class="action-buttons d-flex justify-content-start gap-3">
        <div class="col-6 col-lg-6 d-flex mb-md-1 justify-content-start">
          <div class="dropdown" style="display: none">
            <button
              class="btn btn-white btn-filter dropdown-toggle"
              type="button"
              id="dropdownMenuButton"
              data-bs-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <i class="bi bi-filter pe-3"></i>Filters
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <ng-container *ngFor="let drp of dropdownList">
                <a class="dropdown-item" (click)="addFilter(drp)">{{ drp }}</a>
              </ng-container>
            </div>
          </div>
          <ng-container *ngFor="let filter of filters">
            <div class="filter-pills">
              <div class="dropdown">
                <div
                  class="btn btn-white btn-filter dropdown-toggle"
                  id="dropdownMenuButton"
                  data-bs-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  {{ filter }}
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" *ngIf="dropdownObj[filter]">
                    <ng-container *ngFor="let child of dropdownObj[filter]">
                      <div class="dropdown-item">
                        <input
                          type="checkbox"
                          class="form-check-input"
                          id="dropdownCheck"
                          [checked]="isChecked(filter, child)"
                          (change)="filterByType(filter, child)"
                        />
                        <label class="form-check-label" for="dropdownCheck">
                          <a (click)="filterByType(filter, child)">
                            {{ filter === "Team" ? child["teamName"] : child["leagueName"] }}
                          </a>
                        </label>
                      </div>
                    </ng-container>
                  </div>
                  <span class="close-icon" (click)="removeFilter(filter)">&times;</span>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        <div class="col-6 col-lg-6 d-flex mb-md-1 justify-content-start">
          <div class="btn-group" role="group" aria-label="Basic example">
            <button class="btn btn-gradient" (click)="togglePlayerForm()"><i class="bi bi-plus pe-3"></i>Add Player</button>
            <button class="btn btn-gradient" (click)="open(content)">Contact Us</button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="form-group">
        <input
          type="text"
          class="form-control"
          id="name"
          placeholder="Player's Name"
          class="form-control"
          (keyup)="filterPlayersByName($event.target.value)"
        />
      </div>
    </div>
    <div class="col-lg-3">
      <div class="form-group">
        <ng-multiselect-dropdown
          [placeholder]="'EID'"
          [settings]="eidDropdownSettings"
          [data]="dropEID"
          (onSelect)="onEidSelect($event)"
          (onSelectAll)="onSelectAll($event)"
          (onDeSelect)="onDeSelect($event)"
        >
        </ng-multiselect-dropdown>
      </div>
    </div>
  </div>
  <div class="row">
    <app-coach-squad-list
      [players]="data"
      (delPlayer)="onDeletePlayer($event)"
      (editPlayer)="updatePlayer($event)"
      [teams]="teams"
    ></app-coach-squad-list>
  </div>
</div>
<div style="position: absolute; bottom: 0; right: 0; background-color: transparent; z-index: 2">
  <button class="btn btn-back" (click)="redirectTo()">Back</button>
</div>
